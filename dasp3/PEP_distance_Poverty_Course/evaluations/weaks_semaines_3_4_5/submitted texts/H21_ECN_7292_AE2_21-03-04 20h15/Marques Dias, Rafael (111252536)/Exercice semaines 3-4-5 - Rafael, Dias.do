clear
_daspmenu

***************************************************************************
//code Stata : Évaluation | Rafael Dias | Exercice 3-4-5 | 23 février
***************************************************************************

//  EXERCICE 1***4%

input group	inc1	inc2	inc3
1	2	16	2
1	4	16	4
1	18	16	18
2	4	32	2
2	8	32	4
2	36	32	18
end

// Q1.1
// a)
 igini inc1, hgroup(group)
/*
 -------------------------------------------------------------------------------------------
                  Group   |       Estimate            STE             LB              UB  
--------------------------+----------------------------------------------------------------
1: 1                      |        0.444444        0.100411        0.186331        0.702558
2: 2                      |        0.444444        0.100411        0.186331        0.702558
--------------------------+----------------------------------------------------------------
Population                |        0.500000        0.069166        0.322203        0.677797
-------------------------------------------------------------------------------------------
*/
*l'inégalité de revenu du groupe 1 est égale à celle du groupe 2

// b)
*l'inégalité de revenu du groupe 1 n'est pas égale à celle de la population totale.
*I(groupe1)=0.44 < 0.5 I(population), i.e. plus d'inégalité dans l'ensemble de population.

// c)
dentropyg inc1, hgroup(group) theta(0)
dentropyg inc2, hgroup(group) theta(0)
*la contribution absolue de l'inégalité inter-groupe (voir les lignes "Between") dans les deux distributions est égale à 0.058892


// Q1.2
dentropyg inc1, hgroup(group) theta(0)
*0.481729
/*+---------------------------------------------------------------------------------------------+
  |    Group   |  Entropy index     Population  (mu_k/mu)^theta      Absolute        Relative   |
  |            |                       share                       contribution    contribution |
  |------------+--------------------------------------------------------------------------------|
  |1: Group_1  |        0.422837        0.500000        1.000000        0.211419        0.438875|
  |            |        0.114650        0.223607        0.000000        0.110570        0.239108|
  |2: Group_2  |        0.422837        0.500000        1.000000        0.211419        0.438875|
  |            |        0.114650        0.223607        0.000000        0.110570        0.252003|
  |------------+--------------------------------------------------------------------------------|
  |Within      |            ---             ---             ---         0.422837        0.877750|
  |            |            ---             ---             ---         0.081070        0.242790|
  |------------+--------------------------------------------------------------------------------|
  |Between     |            ---             ---             ---         0.058892        0.122250|
  |            |            ---             ---             ---         0.132769        0.242790|
  |------------+--------------------------------------------------------------------------------|
  |Population  |        0.481729        1.000000            ---         0.481729        1.000000|
  |            |        0.155563        0.000000            ---         0.155563        0.000000|
  +---------------------------------------------------------------------------------------------+*/
dentropyg inc2, hgroup(group) theta(0)
*0.058892
/*+---------------------------------------------------------------------------------------------+
  |    Group   |  Entropy index     Population  (mu_k/mu)^theta      Absolute        Relative   |
  |            |                       share                       contribution    contribution |
  |------------+--------------------------------------------------------------------------------|
  |1: Group_1  |       -0.000000        0.500000        1.000000       -0.000000       -0.000000|
  |            |               .        0.223607        0.000000        0.000000        0.000000|
  |2: Group_2  |       -0.000000        0.500000        1.000000       -0.000000       -0.000000|
  |            |        0.000000        0.223607        0.000000        0.000000        0.000000|
  |------------+--------------------------------------------------------------------------------|
  |Within      |            ---             ---             ---        -0.000000       -0.000000|
  |            |            ---             ---             ---         0.000000        0.000000|
  |------------+--------------------------------------------------------------------------------|
  |Between     |            ---             ---             ---         0.058892        1.000000|
  |            |            ---             ---             ---         0.005921        0.000000|
  |------------+--------------------------------------------------------------------------------|
  |Population  |        0.058892        1.000000            ---         0.058892        1.000000|
  |            |        0.005921        0.000000            ---         0.005921        0.000000|
  +---------------------------------------------------------------------------------------------+*/
dentropyg inc3, hgroup(group) theta(0)
*0.422837
/*+---------------------------------------------------------------------------------------------+
  |    Group   |  Entropy index     Population  (mu_k/mu)^theta      Absolute        Relative   |
  |            |                       share                       contribution    contribution |
  |------------+--------------------------------------------------------------------------------|
  |1: Group_1  |        0.422837        0.500000        1.000000        0.211419        0.500000|
  |            |        0.114650        0.223607        0.000000        0.110570        0.243290|
  |2: Group_2  |        0.422837        0.500000        1.000000        0.211419        0.500000|
  |            |        0.114650        0.223607        0.000000        0.110570        0.243290|
  |------------+--------------------------------------------------------------------------------|
  |Within      |            ---             ---             ---         0.422837        1.000000|
  |            |            ---             ---             ---         0.081070        0.000000|
  |------------+--------------------------------------------------------------------------------|
  |Between     |            ---             ---             ---        -0.000000       -0.000000|
  |            |            ---             ---             ---         0.000000        0.000000|
  |------------+--------------------------------------------------------------------------------|
  |Population  |        0.422837        1.000000            ---         0.422837        1.000000|
  |            |        0.081070        0.000000            ---         0.081070        0.000000|
  +---------------------------------------------------------------------------------------------+*/

*/

// Q1.3
igini inc*
/*
-------------------------------------------------------------------------------------------
               Variable   |       Estimate            STE             LB              UB  
--------------------------+----------------------------------------------------------------
1: GINI_inc1              |        0.500000        0.069166        0.322203        0.677797
2: GINI_inc2              |        0.166667        0.024845        0.102800        0.230533
3: GINI_inc3              |        0.444444        0.071001        0.261930        0.626958
-------------------------------------------------------------------------------------------
*/
*Les deux indices (gini et entropie) ont la même ordre d'inégalité pour les trois distributions (inc1>inc3>inc2).
*Malgré inc1 et inc2 ont la même contribution d'inégalité inter-groupe pour l'inégalité totale (comme discuté en Q1.1c), la contribution intra-groupe de inc2 est nulle, puisque dans chaque groupe tous les individus ont le même revenu, alors qu'en inc1 cette contribution est très importante d'une façon absolue (0.42) et relative (88%).
*Malgré inc3 est la distribution plus pauvre, elle est moins inégale que inc2, puisqu'elle en respectant le principe d'invariance de population (comme discuté en Q1.1b), il y a moins d'écart entre les revenus (inc2:[2,18] vs. inc1:[2,36]).

***************************************************************************
clear

//  EXERCICE 2*****5%

input identifier	pre_tax_income  hhsize	nchild
1	480		8	4
2	1200	10	6
3	460		6	4
4	2500	6	2
5	3800	8	2
6	560		8	4
7	1240	6	2
8	1760	8	6
end

// Q2.1
gen pcincatA = pre_tax_income * (1.00-0.10)/hhsize
gen pcincatB = pre_tax_income * (1.00-0.10)/hhsize

gen pcunicA = 12000*0.10*0.60/60
gen pcunicB = 0

scalar child_all_A  = 12000*0.10*0.40/30
gen pcallowA = child_all_A*nchild/hhsize
scalar child_all_B  = 12000*0.10/30
gen pcallowB = child_all_B*nchild/hhsize

gen dpcincA = pcincatA+pcunicA+pcallowA
gen dpcincB = pcincatB+pcunicB+pcallowB

// Q2.2
igini dpcincA dpcincB , hsize(hhsize)
/*--------------------------------------------------------------------------------------------
                  Variable   |       Estimate            STE             LB              UB  
-----------------------------+----------------------------------------------------------------
1: GINI_dpcincA              |        0.353067        0.042274        0.253105        0.453028
2: GINI_dpcincB              |        0.348667        0.042336        0.248557        0.448776
----------------------------------------------------------------------------------------------*/

// Q2.3
diginis pcincatA  pcunicA pcallowA, hsize(hhsize)
/*+-------------------------------------------------------------------------------------+
  |          Sources   |      Income      Concentration      Absolute        Relative   |
  |                    |       Share       Index           Contribution    Contribution |
  |--------------------+----------------------------------------------------------------|
  |1: pcincatA         |        0.900000        0.395556        0.356000        1.008308|
  |                    |        0.028478        0.049440        0.042978        0.006154|
  |2: pcunicA          |        0.060000        0.000000        0.000000        0.000000|
  |                    |        0.015088        0.000000        0.000000        0.000000|
  |3: pcallowA         |        0.040000       -0.073333       -0.002933       -0.008308|
  |                    |        0.013684        0.077784        0.002248        0.006154|
  |--------------------+----------------------------------------------------------------|
  |              Total |        1.000000            ---         0.353067        1.000000|
  |                    |        0.000000            ---         0.042274        0.000000|
  +-------------------------------------------------------------------------------------+*/
diginis pcincatB  pcunicB pcallowB, hsize(hhsize)
/*+-------------------------------------------------------------------------------------+
  |          Sources   |      Income      Concentration      Absolute        Relative   |
  |                    |       Share       Index           Contribution    Contribution |
  |--------------------+----------------------------------------------------------------|
  |1: pcincatB         |        0.900000        0.395556        0.356000        1.021032|
  |                    |        0.033607        0.049440        0.044140        0.015775|
  |2: pcunicB          |        0.000000        0.000000        0.000000        0.000000|
  |                    |        0.000000               .        0.000000        0.000000|
  |3: pcallowB         |        0.100000       -0.073333       -0.007333       -0.021033|
  |                    |        0.033607        0.077784        0.005663        0.015775|
  |--------------------+----------------------------------------------------------------|
  |              Total |        1.000000            ---         0.348667        1.000000|
  |                    |        0.000000            ---         0.042336        0.000000|
  +-------------------------------------------------------------------------------------+*/

// Q2.4
sort dpcincA
* la distribution dans le scénario B est un peu plus équitable.

// Q2.5
gen pcinc = pre_tax_income/hhsize
difgt dpcincB pcinc, hsize1(hhsize)  hsize2(hhsize) pline1(100) pline2(100) alpha(0)
*taux de pauvreté : alpha=0
/*----------------------------------------------------------------------------------------
   Index |   Estimate   Std. Err.       t     P>|t|       [95% Conf. interval]  Pov. line
---------+--------------------------------------------------------------------------------
 dpcincB |  .3666667    .1835415   1.99773   0.0859        -.06734    .8006734       100
   pcinc |  .3666667    .1835415   1.99773   0.0859        -.06734    .8006734       100
---------+--------------------------------------------------------------------------------
    diff.|         0    2.91e-10         0   1.0000      -6.88e-10    6.88e-10      ---
------------------------------------------------------------------------------------------*/

// Q2.6
difgt dpcincB pcinc, hsize1(hhsize)  hsize2(hhsize) pline1(100) pline2(100) alpha(1)
*intensité de pauvreté : alpha=1
/*----------------------------------------------------------------------------------------
   Index |   Estimate   Std. Err.       t     P>|t|       [95% Conf. interval]  Pov. line
---------+--------------------------------------------------------------------------------
 dpcincB |  .0616667    .0374656   1.64596   0.1438      -.0269254    .1502588       100
   pcinc |  .1166667     .061366   1.90116   0.0990      -.0284408    .2617742       100
---------+--------------------------------------------------------------------------------
    diff.|      .055     .027522    1.9984   0.0858      -.0100792    .1200792      ---
------------------------------------------------------------------------------------------
*Dans les deux distributions il y a 3 revenus disponibles par habitant en-dessous du seuil de pauvreté (initial:{60,70,77} , B:{74,83,96})
*Cependant l'intensité de la pauvreté est reduit en B.
*Comme la hausse des revenus n'a pas permit aux 3 revenus disponibles par habitant sortir du seuil de pauvreté, le taux de pauvreté reste le même. C'est-à dire que le taux de pauvreté est insensible à la hausse des revenus des pauvres.
*Cependant, cette hausse est prise en compte pour les indices de pauvreté.
*La différence entre ces derniers indices indiquent que la distribution est plus équitable au scénario B (I(initial)=0.1166667 , I(B)=0.0616667).*/

***************************************************************************
clear

//  EXERCICE 3*3%

cd "/Users/rafaeldias/OneDrive - Université Laval/economia/2021/Pauvrete et inegalite ECN6992/data/"


// Q3.1
use data_3.dta
svyset psu [pweight=sweight], strata(strata)
*svydes 		pour visualiser

// Q 3.2
ifgt ae_exp, alpha(0) hsize(hsize) pline(21000)
/*---------------------------------------------------------------------------------------------
   Variable   |       Estimate            STE             LB              UB         Pov. line
--------------+--------------------------------------------------------------------------------
ae_exp        |        0.316088        0.013949        0.288713        0.343464        21000.00
-----------------------------------------------------------------------------------------------*/

// Q 3.3
ifgt ae_exp, alpha(0) hsize(hsize) hgroup(sex) pline(21000)
/*----------------------------------------------------------------------------------------------
       Group   |       Estimate            STE             LB              UB         Pov. line
---------------+--------------------------------------------------------------------------------
1: Male        |        0.301265        0.013811        0.274160        0.328370        21000.00
2: Female      |        0.370129        0.033178        0.305014        0.435243        21000.00
---------------+--------------------------------------------------------------------------------
Population     |        0.316088        0.013949        0.288713        0.343464        21000.00
------------------------------------------------------------------------------------------------*/
*taux de pauvreté plus important chez les femmes.
